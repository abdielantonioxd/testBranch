app.controller("ctrl-create-profile",["$scope","Dataservice",function($scope,Dataservice){$scope.serviceOthers=[];var serviceOthers=[];$scope.serviceAdicionalOthers=[];var serviceAdicional=[];function sendDataPersonalDB(obj){$.ajax({type:"POST",url:UrlSendDatosPersonal,timeout:2e3,data:obj,success:function(data){getData(),alertify.set("notifier","position","top-right"),alertify.success("Sus datos personales fueron guardados correctamente")},error:function(textStatus,err){console.log(err)}})}function messageAlert(ve){swal({title:"Nanny365!",text:"Esta opción no está disponible Contáctanos al “6498-2991” Para mas información ",icon:"error"}),document.getElementById(ve.id).checked=!1}function sendDisponibilidad(obj){$.ajax({type:"POST",url:UrlSendDisponibilidad,timeout:2e3,data:obj,success:function(data){var id;alertify.set("notifier","position","top-right"),alertify.success("Su disponibilidad  fue   guardada correctamente"),getDisponibilidad($scope.sessionExist[0].id)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendDataGeneral(obj){$.ajax({type:"POST",url:UrlSendDatosGenral,timeout:2e3,data:obj,success:function(data){alertify.set("notifier","position","top-right"),alertify.success("Sus datos generales fueron guardados correctamente")},error:function(textStatus,err){console.log(textStatus+""+err)}})}function ACCESS(){if(""!=$scope.sessionExist&&null!=$scope.sessionExist){var idNanny=Dataservice.GetFilter();if(null==idNanny)location.href="/";else if($scope.sessionExist[0].id==idNanny.nanny){alertify.set("notifier","position","top-right"),alertify.success("Bienvenido a su sesión en Nanny 365");var id=$scope.sessionExist[0].id;getImages(id),getData(),getDisponibilidad(id)}else alertify.set("notifier","position","top-right"),alertify.error("No tiene acceso a esta página, si lo considera un error  por favor contacte a Nanny 365"),location.href="/"}else location.href="/"}function getImages(id){$.ajax({type:"POST",url:"api/get-images/json",timeout:2e3,data:{id:id},success:function(data){$scope.datosUser=data.result.Database[0].Table.Row[0],1==$scope.datosUser.length&&(document.getElementById("chamgeImages").src="/public/images/"+$scope.datosUser[0].imagesP)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function getData(){Dataservice.getData($scope.sessionExist[0].id).then(function(response){var dataPersonal=response.data.result.Database[0].Table.Row[0];$scope.images=dataPersonal.imagesP,0!=dataPersonal.length&&(setDataPersonal(dataPersonal),setDataGeneral(dataPersonal))})}function setDataPersonal(dataPersonal){$("#preview").hide(),document.getElementById("nombre").value=dataPersonal[0].nombre,document.getElementById("telefono").value=dataPersonal[0].telefono,document.getElementById("identificacion").value=dataPersonal[0].numeroID,$scope.fechaNacimiento=dataPersonal[0].fechaNacimiento,$scope.Images=dataPersonal[0].imagesID,$scope.ImagesPrincipal=dataPersonal[0].imagesP,""!=$scope.Images&&($scope.imagesID=!1,document.getElementById("chamgeImagesID").src="/public/images/"+$scope.Images),""!=dataPersonal[0].numeroID&&($scope.identificationInput=!1,$scope.validID=!0),"on"==dataPersonal[0].privateNumber?($(".toggle").removeClass("btn-outline-danger off"),$(".toggle").addClass("btn-outline-success")):($(".toggle").addClass("btn-outline-danger off"),$(".toggle").removeClass("btn-outline-success"))}function setDataGeneral(dataPersonal){document.getElementById("tarifa").value=dataPersonal[0].tarifa,document.getElementById("sobreMi").value=dataPersonal[0].sobreMi;var objservicesEs=dataPersonal[0].serviciosEspeciales;null==objservicesEs?$scope.servicesEs="":($scope.servicesEs=objservicesEs.split(",",9),$scope.serviceEspe=$scope.servicesEs);var objOthersEspe=dataPersonal[0].othersServiceEspeciales;null==objOthersEspe?$scope.serviceOthers="":($scope.othersEspe=objOthersEspe.split(",",9),$scope.serviceOthers=$scope.othersEspe);var objservices=dataPersonal[0].servicios;null==objservices?$scope.servicesCheck=null:($scope.servicesCheck=objservices.split(",",9),$scope.service=$scope.servicesCheck);var objOthersAdi=dataPersonal[0].othersInformacionAdicional;null==objOthersAdi?$scope.serviceAdicionalOthers="":($scope.othersADi=objOthersAdi.split(",",9),$scope.serviceAdicionalOthers=$scope.othersADi);var objcertification=dataPersonal[0].certificacion;null==objcertification?$scope.cert:($scope.cert=objcertification.split(",",9),$scope.certification=$scope.cert);var objverificaciones=dataPersonal[0].verificacion;null==objverificaciones?$scope.verificacion="":($scope.verificacion=objverificaciones.split(",",9),$scope.verification=$scope.verificacion);var objservicesA=dataPersonal[0].serviciosAdicionales;null==objservicesA?$scope.servicesA="":($scope.servicesA=objservicesA.split(",",9),$scope.serviceAditional=$scope.servicesA);var objzonasD=dataPersonal[0].zona;null==objzonasD?$scope.zonasdondePS="":($scope.zonasdondePS=objzonasD.split(",",9),$scope.zonas=$scope.zonasdondePS);for(let i=0;i<5;i++)dataPersonal[0].experiencia==$scope.experience[i].name&&(document.getElementById($scope.experience[i].id).checked=!0,$scope.expe=$scope.experience[i].name);$.each($scope.servicesCheck,function(i,v){var gruposE=$scope.services;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),$.each($scope.servicesEs,function(i,v){var gruposE=$scope.serviceEspecial;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),$.each($scope.servicesA,function(i,v){var gruposE=$scope.serviceEspecialTwo;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),$.each($scope.cert,function(i,v){var gruposE=$scope.certificacion;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),$.each($scope.verificacion,function(i,v){var gruposE=$scope.certificaionTwo;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),$.each($scope.zonasdondePS,function(i,v){var gruposE=$scope.Zonas;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),""!=dataPersonal[0].othersServiceEspeciales&&null!=dataPersonal[0].othersServiceEspeciales?$scope.otherServicesEspecial=!1:$scope.otherServicesEspecial=!0,""!=dataPersonal[0].othersInformacionAdicional&&null!=dataPersonal[0].othersInformacionAdicional?$scope.otherServicesAdicional=!1:$scope.otherServicesAdicional=!0}function getDisponibilidad(id){Dataservice.getDisponibilidadNanny(id).then(function(data){var disponibilidad=data.data.result.Database[0].Table.Row[0];0==disponibilidad.length?(alertify.set("notifier","position","top-right"),alertify.error("No has publicado tus  disponibilidad en Nanny 365")):setdataDisponibilidad(disponibilidad)})}function setdataDisponibilidad(disponibilidad){for(const i in disponibilidad)document.getElementById(`${disponibilidad[i].dia}`).value=disponibilidad[i].horaInicio,document.getElementById(`${disponibilidad[i].dia}Cierre`).value=disponibilidad[i].horaFinal}$scope.delete=[],$scope.deleteES=[],$scope.deleteAd=[],$scope.deleteCe=[],$scope.deleteVe=[],$scope.deleteZo=[],$scope.serviceEspe=[],$scope.service=[],$scope.serviceAditional=[],$scope.certification=[],$scope.verification="",$scope.zonas=[],$scope.expe="",$scope.NExpe="",$scope.tarifa=0,$scope.sobreMi="",$scope.imagesID=!0,$scope.privateOn=!0,$scope.privateOf=!1,$scope.otherServicesEspecial=!0,$scope.otherServicesAdicional=!0,$scope.identificationInput=!0,$scope.validID=!1,$scope.cedula="",$scope.limit=4,$scope.experience=Check_Experience,$scope.services=Check_Services,$scope.serviceEspecial=Check_ServicesEspecial,$scope.serviceEspecialTwo=Check_ServicesEspecialTwo,$scope.certificacion=ckeck_certificacionesOne,$scope.certificaionTwo=ckeck_certificacionesTwo,$scope.Zonas=SearchZonas.sort(),$scope.Serv=servicesObj,$scope.sessionExist=JSON.parse(ExistSession),$scope.fechaNacimiento="2019-01-01",$scope.imagesPlaceholder=!1,$scope.PassworID=!1,$scope.userExist=UserNanny,$scope.usersExistFacebook=UserFacebook,$scope.userExistGoogle=UserGoogle,$scope.userExistFather=UserFather,$scope.enter=function($event){console.log($event)},$scope.identID=function(){$scope.identificationInput=!1,$scope.c=$("#cedula").prop("checked"),$scope.p=$("#Pasaporte").prop("checked")},$scope.validateDataPersonal=function(){var privateNumber=$("#privateNumber").prop("checked");if(form=$("#formDataPersonal").serializeArray(),0!=$scope.validID){$scope.imagesID=imagesID,0!=$scope.imagesID.length?form.push({name:"imagesID",value:$scope.imagesID[0].name}):" "!=$scope.Images?form.push({name:"imagesID",value:$scope.Images}):form.push({name:"imagesID",value:"peril.png"}),1==privateNumber?form.push({name:"privateNumber",value:"on"}):form.push({name:"privateNumber",value:"of"}),form.push({name:"id",value:$scope.sessionExist[0].id}),form.push({name:"distrito",value:""}),obj=new Object;for(const i in form)obj[form[i].name]=form[i].value;""!=obj.nombre?"2019-01-01"!=obj.fechaN?($scope.saveImagesP(),sendDataPersonalDB(obj)):(alertify.set("notifier","position","top-right"),alertify.error("ocurrio un error,Ingresa tu verdadera fecha de nacimiento")):(alertify.set("notifier","position","top-right"),alertify.error("ocurrio un error,Todos los campos son obligatorios !"))}else alertify.set("notifier","position","top-right"),alertify.error("ocurrio un error! El formato de cédula no es válido")},$scope.saveImagesP=function(){if($scope.imagesP=imagesP,0!=$scope.imagesP.length)var obj={imagesP:$scope.imagesP[0].name,id:$scope.sessionExist[0].id};else if(""!=$scope.ImagesPrincipal)var obj={imagesP:$scope.ImagesPrincipal,id:$scope.sessionExist[0].id};else var obj={imagesP:"perfil.png",id:$scope.sessionExist[0].id};$.ajax({type:"POST",url:UrlSendImages,timeout:2e3,data:obj,success:function(data){alertify.set("notifier","position","top-right"),alertify.success("Imagen Guardada correctamente")},error:function(textStatus,err){console.log(textStatus+""+err)}})},$scope.getExperience=function(e){if(experiencia=e.name,$scope.expe=experiencia,"Sin Experiencia"==experiencia)$scope.NExpe=0;else{var separador=$scope.expe.split(" ",5);$scope.NExpe=separador[0]}},$scope.getServices=function(s){function addServNanny(){if(0==$scope.service.length)$scope.service.push(services);else{$.each($scope.service,function(s,v){v==services?($scope.service.splice(s,1),$scope.delete.push($scope.service.splice(s,1))):$scope.service.push(services)});var NgroupYearsOld=$scope.service.filter(function(item,index,array){return array.indexOf(item)===index});for(const key in NgroupYearsOld)for(const key2 in $scope.delete)NgroupYearsOld[key]==$scope.delete[key2]&&NgroupYearsOld.splice(key,1);0==NgroupYearsOld.length?$scope.service="":$scope.service=NgroupYearsOld}}services=s.name,""==$scope.service[0]?($scope.service.splice(0,1),addServNanny()):addServNanny()},$scope.getServiceEsp=function(se){function addServEspecial(){if(0==$scope.serviceEspe.length||""==$scope.serviceEspe)$scope.serviceEspe.push(servicesEsp);else{$.each($scope.serviceEspe,function(i,v){v==servicesEsp?($scope.serviceEspe.splice(i,1),$scope.deleteES.push($scope.serviceEspe.splice(i,1))):$scope.serviceEspe.push(servicesEsp)});var NserviceEspeciales=$scope.serviceEspe.filter(function(item,index,array){return array.indexOf(item)===index});for(const keyes in NserviceEspeciales)for(const keyes2 in $scope.deleteES)NserviceEspeciales[keyes]==$scope.deleteES[keyes2]&&NserviceEspeciales.splice(keyes,1);0==NserviceEspeciales.length?$scope.serviceEspe="":$scope.serviceEspe=NserviceEspeciales}}servicesEsp=se.name,"others"==se.id?""==$scope.serviceOthers[0]?($scope.serviceOthers.splice(0,1),$scope.otherServicesEspecial=!1):$scope.otherServicesEspecial=!1:""==$scope.serviceEspe[0]?($scope.serviceEspe.splice(0,1),addServEspecial()):addServEspecial()},$scope.addOthersServiceEspeciales=function(){var others=document.getElementById("othersService").value;""==$scope.serviceOthers[0]?($scope.serviceOthers.splice(0,1),serviceOthers.push(others),$scope.serviceOthers=serviceOthers):(serviceOthers.push(others),$scope.serviceOthers=serviceOthers,document.getElementById("othersService").value="")},$scope.deleteOthersServiceEspe=function(del){$.each($scope.serviceOthers,function(s,v){v==del&&$scope.serviceOthers.splice(s,1)})},$scope.getServiceaditional=function(serv){function addServAdicional(){if(0==$scope.serviceAditional.length)$scope.serviceAditional.push(servicesaditional);else{$.each($scope.serviceAditional,function(s,v){v==servicesaditional?($scope.serviceAditional.splice(s,1),$scope.deleteAd.push($scope.serviceAditional.splice(s,1))):$scope.serviceAditional.push(servicesaditional)});var NserviceAdi=$scope.serviceAditional.filter(function(item,index,array){return array.indexOf(item)===index});for(const key in NserviceAdi)for(const key2 in $scope.deleteAd)NserviceAdi[key]==$scope.deleteAd[key2]&&NserviceAdi.splice(key,1);0==NserviceAdi.length?$scope.serviceAditional="":$scope.serviceAditional=NserviceAdi}}servicesaditional=serv.name,"otherstwo"==serv.id?""==$scope.serviceAdicionalOthers[0]?($scope.serviceAdicionalOthers.splice(0,1),$scope.otherServicesAdicional=!1):$scope.otherServicesAdicional=!1:""==$scope.serviceAditional[0]?($scope.serviceAditional.splice(0,1),addServAdicional()):addServAdicional()},$scope.addOthersServiceAdicionales=function(){var othersAdi=document.getElementById("othersServiceAdicional").value;""==$scope.serviceAdicionalOthers[0]?($scope.serviceAdicionalOthers.splice(0,1),serviceAdicional.push(othersAdi),$scope.serviceAdicionalOthers=serviceAdicional):(serviceAdicional.push(othersAdi),$scope.serviceAdicionalOthers=serviceAdicional,document.getElementById("othersServiceAdicional").value="")},$scope.deleteOthersServiceAdi=function(del){$.each($scope.serviceAdicionalOthers,function(s,v){v==del&&$scope.serviceAdicionalOthers.splice(s,1)})},$scope.getCertification=function(ce){function addCertificacion(){if(0==$scope.certification.length)$scope.certification.push(certifications);else{$.each($scope.certification,function(s,v){v==certifications?($scope.certification.splice(s,1),$scope.deleteCe.push($scope.certification.splice(s,1))):$scope.certification.push(certifications)});var Ncertification=$scope.certification.filter(function(item,index,array){return array.indexOf(item)===index});for(const key in Ncertification)for(const key2 in $scope.deleteCe)Ncertification[key]==$scope.deleteCe[key2]&&Ncertification.splice(key,1);0==Ncertification.length?$scope.certification="":$scope.certification=Ncertification}}certifications=ce.name,""==$scope.certification[0]?($scope.certification.splice(0,1),addCertificacion()):addCertificacion()},$scope.getverification=function(ce2){function addVerificacion(){if(0==$scope.verification.length)$scope.verification.push(verifi);else{$.each($scope.verification,function(s,v){v==verifi?($scope.verification.splice(s,1),$scope.deleteVe.push($scope.verification.splice(s,1))):$scope.verification.push(verifi)});var Nverification=$scope.verification.filter(function(item,index,array){return array.indexOf(item)===index});for(const key in Nverification)for(const key2 in $scope.deleteVe)Nverification[key]==$scope.deleteVe[key2]&&Nverification.splice(key,1);0==Nverification.length?$scope.verification="":$scope.verification=Nverification}}verifi=ce2.name,""==$scope.verification[0]?($scope.verification.splice(0,1),messageAlert(ce2)):messageAlert(ce2)},$scope.getZonas=function(obj){var desplazamiento=obj.name;function addZonasDesplazamiento(){if(0==$scope.zonas.length)$scope.zonas.push(desplazamiento);else{$.each($scope.zonas,function(s,v){v==desplazamiento?($scope.zonas.splice(s,1),$scope.deleteZo.push($scope.zonas.splice(s,1))):$scope.zonas.push(desplazamiento)});var Nzonas=$scope.zonas.filter(function(item,index,array){return array.indexOf(item)===index});for(const key in Nzonas)for(const key2 in $scope.deleteZo)Nzonas[key]==$scope.deleteZo[key2]&&Nzonas.splice(key,1);0==Nzonas.length?$scope.zonas="":$scope.zonas=Nzonas}}""==$scope.zonas[0]?($scope.zonas.splice(0,1),addZonasDesplazamiento()):addZonasDesplazamiento()},$scope.sendDataAditionalDB=function(){var obj;0==$scope.serviceOthers.length&&($scope.serviceOthers=""),0==$scope.serviceAdicionalOthers.length&&($scope.serviceAdicionalOthers=""),sendDataGeneral({numExperiencia:$scope.NExpe,experiencia:$scope.expe,servicios:$scope.service,serviciosEspeciales:$scope.serviceEspe,serviciosAdicionales:$scope.serviceAditional,certificacion:$scope.certification,verification:"",tarifa:document.getElementById("tarifa").value,zona:$scope.zonas,sobreMi:document.getElementById("sobreMi").value,id:$scope.sessionExist[0].id,othersServiceEspe:$scope.serviceOthers,othersServiceAdi:$scope.serviceAdicionalOthers})},$scope.sendDataDisponibilidad=function(){form=$("#Disponibilidad").serializeArray(),form.push({name:"id",value:$scope.sessionExist[0].id}),obj=new Object;for(const i in form)obj[form[i].name]=form[i].value;sendDisponibilidad(obj)},$scope.imagesProfile=function(){$("#modalImages").modal("show")},$scope.validateCedula=function(cedula){if(1==$scope.c){Array.prototype.insert=function(index,item){this.splice(index,0,item)};var re=/^P$|^(?:PE|E|N|[23456789]|[23456789](?:A|P)?|1[0123456789]?|1[0123456789]?(?:A|P)?)$|^(?:PE|E|N|[23456789]|[23456789](?:AV|PI)?|1[0123456789]?|1[0123456789]?(?:AV|PI)?)-?$|^(?:PE|E|N|[23456789](?:AV|PI)?|1[0123456789]?(?:AV|PI)?)-(?:\d{1,4})-?$|^(PE|E|N|[23456789](?:AV|PI)?|1[0123456789]?(?:AV|PI)?)-(\d{1,4})-(\d{1,9})$/i,matched=cedula.match(re),isComplete=!1,result;if(null!==matched&&(matched.splice(0,1),void 0!==matched[0]&&(isComplete=!0,matched[0].match(/^PE|E|N$/)&&matched.insert(0,"0"),matched[0].match(/^(1[0123456789]?|[23456789])?$/)&&matched.insert(1,""),matched[0].match(/^(1[0123456789]?|[23456789])(AV|PI)$/)))){var tmp=matched[0].match(/(\d+)(\w+)/);matched.splice(0,1),matched.insert(0,tmp[1]),matched.insert(1,tmp[2])}null=={isValid:0==cedula.length||re.test(cedula),inputString:cedula,isComplete:isComplete,cedula:isComplete?matched.splice(0,3):null}.cedula?(alertify.set("notifier","position","bottom-center"),alertify.error("El formato de la cédula no es válida"),$scope.validID=!1):$scope.validID=!0}else $scope.validID=!0,console.log(".")},ACCESS()}]);