app.controller("ctrl-search-nanny",["$scope","Dataservice","$http",function($scope,Dataservice,$http){let{cookie:cookie}=plugdo;$scope.sessionExist=JSON.parse(ExistSession),$scope.zonas=SearchZonas,$scope.experience=Check_Experience,$scope.serviceEspecial=Check_ServicesEspecial,$scope.serviceEspecialTwo=Check_ServicesEspecialTwo,$scope.services=Check_Services,$scope.Zonas=SearchZonas,$scope.numPagesselected=numPages,$scope.value=0,$scope.valueTarifas=0,$scope.zona="",$scope.experiencias="",$scope.hidelimit=!1,$scope.hidelimitTo=!0,$scope.viewTarifa=!1,$scope.certifify=!0,$scope.verify=!0,$scope.limit=4,$scope.newExpe=0,$scope.experiencia="";var oldValueExpe="",oldValueGroup="",oldValuesServiceEsp="",oldValueZonas="",listYearOldNanny=[],listServicesSpecial=[],listZonasNannys=[],listTempGroupYears=[],listTemServicesEsp=[],listTemZone=[],setRangeYearsOldMin=18,setRangeYearsOldMax=80,setRangePricedMin=5,setRangePricedMax=100,exp=$scope.newExpe,op=10,Pselect=1,cookie_experience=cookie.get("experience-persistence"),cookie_groupYears=cookie.get("groupYearsOldNannys-persistence"),cookie_serviceEsp=cookie.get("servicesEspe-persistence"),cookie_zone=cookie.get("zone-persistence"),cookie_rangeYearsOld=cookie.get("rangeYearsOld-persistence"),cookie_rangePrice=cookie.get("rangePrice-persistence"),cookie_pagesSelected=cookie.get("PagesSelected-persistence");function filterListYearsOld(){var obj={data:listZonasNannys+","+listServicesSpecial+","+listYearOldNanny,experiencia:$scope.newExpe,option:"GruposE"};console.log(obj),$scope.filterList(obj)}function showNewData(newDataNanny){$scope.$watch($scope.resultNanny=newDataNanny,$scope.result=newDataNanny.length),alertify.set("notifier","position","top-right"),alertify.success(`${$scope.result} Resultados de la busqueda `);var numPages=$scope.result,numPages=10;pagination(10,Pselect)}function filterYearsOld(setRangeYearsOldMin,setRangeYearsOldMax,exp){var i=0,slider2=new rSlider({target:"#yearsOld",values:[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,32,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80],step:1,range:!0,set:[setRangeYearsOldMin,setRangeYearsOldMax],tooltip:!0,scale:!0,labels:!1,width:null,onChange:function(vals){if("18,80"!=vals){var objservicesE,yearsOld=vals.split(",");if(""!=cookie_experience){var experi,separador=cookie_experience.split(" ",5);exp=separador[0]}else exp=""!=$scope.newExpe?$scope.newExpe:0;var obj={dataOne:2019-yearsOld[0],dataTwo:2019-yearsOld[1],experience:exp,option:"Edad"};$scope.GMin=yearsOld[0],$scope.GMax=yearsOld[1],cookie.set("rangeYearsOld-persistence",yearsOld,1),i>0&&"18"!=obj.dataOne&&"80"!=obj.dataTwo&&$scope.filterRanges(obj),i++}}})}function filterPrice(setRangePricedMin,setRangePricedMax,exp){var p=0,slider3=new rSlider({target:"#priceRange",values:[5,10,15,20,25,30,35,50,55,60,65,70,75,80,85,90,95,100],step:1,range:!0,set:[setRangePricedMin,setRangePricedMax],tooltip:!0,scale:!0,labels:!1,width:null,onChange:function(vals){if("5,100"!=vals){var objRanges,range=vals.split(",");if($scope.viewTarifa=!0,$scope.tarifa=range[0],$scope.tarifa2=range[1],""!=cookie_experience){var experi,separador=cookie_experience.split(" ",5);exp=separador[0]}else exp=""!=$scope.newExpe?$scope.newExpe:0;var obj={dataOne:range[0],dataTwo:range[1],experience:exp,option:"Tarifa"};$scope.PMin=range[0],$scope.PMax=range[1],cookie.set("rangePrice-persistence",range,1),p>0&&5!=obj.dataOne&&100!=obj.dataTwo&&$scope.filterRanges(obj),p++}}})}function pagination(op,Pselect){$scope.viewby=op,$scope.totalItems=$scope.resultNanny.length,$scope.currentPage=Pselect,$scope.itemsPerPage=$scope.viewby,$scope.maxSize=5,$scope.setPage=function(pageNo){$scope.currentPage=pageNo},$scope.pageChanged=function(){cookie.set("PagesSelected-persistence",$scope.currentPage,1)},$scope.setItemsPerPage=function(num){$scope.itemsPerPage=num,$scope.currentPage=1}}function setPersistenceExp(){if("Sin Experiencia"===cookie_experience)document.getElementById("never").checked=!0;else for(let i=0;i<5;i++)if(cookie_experience===$scope.experience[i].name){document.getElementById($scope.experience[i].id).checked=!0;var separador=cookie_experience.split(" ",5);$scope.persistence_expe=separador[0];var obj={data:"",experiencia:$scope.persistence_expe,option:"Experiencia"};$scope.filter(obj)}}function persistenceGroupOfYearsNannys(){if($scope.groupYearsNannyArray=cookie_groupYears.split(",",9),$scope.groupYears=$scope.groupYearsNannyArray,$.each($scope.groupYears,function(i,v){var array_X=$scope.services;$.each(array_X,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),exp=null!=$scope.persistence_expe&&" "!=$scope.persistence_expe?$scope.persistence_expe:0,$scope.groupYearsNannyArray.length>1){var obj={data:cookie_groupYears,experiencia:exp,option:"GruposE"};$scope.filterList(obj),console.log("Two ")}else{var obj={data:`%${cookie_groupYears}%`,experiencia:exp,option:"GruposE"};$scope.filter(obj),console.log("one ")}}function persistenceServicesEspe(){if($scope.serviceEspNannyArray=cookie_serviceEsp.split(",",9),$scope.servicesEspecialA=$scope.serviceEspNannyArray,$.each($scope.servicesEspecialA,function(i,v){var array_X=$scope.serviceEspecialTwo;$.each(array_X,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),exp=null!=$scope.persistence_expe&&" "!=$scope.persistence_expe?$scope.persistence_expe:0,$scope.serviceEspNannyArray.length>1){var obj={data:cookie_serviceEsp,experiencia:exp,option:"ServiciosEs"};$scope.filterList(obj)}else{var obj={data:`%${cookie_serviceEsp}%`,experiencia:exp,option:"ServiciosEs"};$scope.filter(obj)}}function persistenceZone(){if($scope.zoneNannyArray=cookie_zone.split(",",9),$scope.zoneArr=$scope.zoneNannyArray,$.each($scope.zoneArr,function(i,v){var gruposE=$scope.Zonas;$.each(gruposE,function(l,s){if(v==s.name){var id=s.id;document.getElementById(id).checked=!0}})}),exp=null!=$scope.persistence_expe&&" "!=$scope.persistence_expe?$scope.persistence_expe:0,$scope.zoneNannyArray.length>1){var obj={data:cookie_zone,experiencia:exp,option:"Zonas"};$scope.filterList(obj)}else{var obj={data:`%${cookie_zone}%`,experiencia:exp,option:"Zonas"};$scope.filter(obj)}}function persistenceRangeYearsOld(){var yearsOld=cookie_rangeYearsOld.split(",");setRangeYearsOldMin=yearsOld[0],setRangeYearsOldMax=yearsOld[1],exp=" "!=$scope.persistence_expe?$scope.persistence_expe:0,"18,80"!=cookie_rangeYearsOld&&(intMin=parseInt(setRangeYearsOldMin,10),intMax=parseInt(setRangeYearsOldMax,10),filterYearsOld(intMin,intMax,exp))}function persistenceRangePrice(){var range=cookie_rangePrice.split(",");setRangePricedMin=range[0],setRangePricedMax=range[1],intMin=parseInt(setRangePricedMin,10),intMax=parseInt(setRangePricedMax,10),exp=" "!=$scope.persistence_expe?$scope.persistence_expe:0,"5,100"!=cookie_rangePrice&&filterPrice(intMin,intMax,exp)}$scope.enter=function($event){"Enter"==$event.originalEvent.key&&$scope.searchInput()},$scope.searchInput=function(){var obj={data:`%${document.getElementById("searchInp").value}%`,experiencia:"",option:"searchInp"};$scope.filter(obj)},$scope.experiencias=function(experiencia){if($scope.experiencia=experiencia.name,experiencia.id!=oldValueExpe)if("Sin Experiencia"==$scope.experiencia){$scope.expe=0;var obj={data:"",experiencia:$scope.expe,option:"Experiencia"};oldValueExpe=experiencia.id,cookie.set("experience-persistence",experiencia.name,1),$scope.filter(obj)}else{var separador=$scope.experiencia.split(" ",5);$scope.newExpe=separador[0],oldValueExpe=experiencia.id,cookie.set("experience-persistence",experiencia.name,1);var obj={data:"",experiencia:$scope.newExpe,option:"Experiencia"};oldValueExpe=experiencia.id,$scope.filter(obj)}else oldValueExpe==experiencia.id&&($scope.loadPages(),document.getElementById(experiencia.id).checked=!1)},$scope.getGroupYearsOld=function(getGroupYearsOld){if(""!=listTempGroupYears&&listYearOldNanny.push(listTempGroupYears),getGroupYearsOld.id!=oldValueGroup){if(listYearOldNanny.push(getGroupYearsOld.name),cookie.set("groupYearsOldNannys-persistence",listYearOldNanny,1),listYearOldNanny.length>1)filterListYearsOld();else{var obj={data:`%${listYearOldNanny}%`,experiencia:$scope.newExpe,option:"GruposE"};$scope.filter(obj)}oldValueGroup=getGroupYearsOld.id}else $scope.loadPages(10)},$scope.getServiceEspeciales=function(servEspeciales){if(""!=listTemServicesEsp&&listServicesSpecial.push(listTemServicesEsp),servEspeciales.id!=oldValuesServiceEsp)if(listServicesSpecial.push(servEspeciales.name),cookie.set("servicesEspe-persistence",listServicesSpecial,1),listServicesSpecial.length>1){var obj={data:listZonasNannys+","+listServicesSpecial+","+listYearOldNanny,experiencia:$scope.newExpe,option:"ServiciosEs"};oldValuesServiceEsp=servEspeciales.id,$scope.filterList(obj)}else{var obj={data:`%${servEspeciales.name}%`,experiencia:$scope.newExpe,option:"ServiciosEs"};oldValuesServiceEsp=servEspeciales.id,$scope.filter(obj)}else $scope.loadPages()},$scope.getZonas=function(zonas){if(""!=listTemZone&&listZonasNannys.push(listTemZone),zonas.id!=oldValueZonas)if(listZonasNannys.push(zonas.name),cookie.set("zone-persistence",listZonasNannys,1),listZonasNannys.length>1){var obj={data:listZonasNannys+","+listServicesSpecial+","+listYearOldNanny,experiencia:$scope.newExpe,option:"Zonas"};oldValueZonas=zonas.id,$scope.filterList(obj)}else{var obj={data:`%${zonas.name}%`,experiencia:$scope.newExpe,option:"Zonas"};oldValueZonas=zonas.id,$scope.filter(obj)}else document.getElementById(zonas.id).checked=!1,$scope.loadPages()},$scope.filter=function(obj){Dataservice.sendFilter(obj.data,obj.experiencia,obj.option).then(function(data){var newDataNanny;showNewData(data.data.result.Database[0].Table.Row[0])})},$scope.filterAll=function(obj){Dataservice.sendFilterAll(obj.groupMin,obj.groupMax,obj.groupEdad,obj.serv_esp,obj.tarifaMin,obj.tarifaMax,obj.zonas,obj.experiencia,obj.option).then(function(data){var newDataNanny=data.data.result.Database[0].Table.Row[0];console.log(newDataNanny),showNewData(newDataNanny)})},$scope.filterList=function(obj){Dataservice.sendFilterList(obj.data,obj.experiencia,obj.option).then(function(data){var newDataNanny;showNewData(data.data.result.Database[0].Table.Row[0])})},$scope.limite=function(){$scope.hidelimit=!0,$scope.hidelimitTo=!1,$scope.limit=100},$scope.limitTo=function(){$scope.hidelimit=!1,$scope.hidelimitTo=!0,$scope.limit=4},$scope.filterRanges=function(obj){$.ajax({type:"POST",url:UrlfilterRange,timeout:2e3,data:obj,success:function(data){var newDataNanny=data.result.Database[0].Table.Row[0];$scope.$digest($scope.resultNanny=newDataNanny,$scope.result=newDataNanny.length)},error:function(textStatus,err){console.log(textStatus+""+err)}})},$scope.loadPages=function(op,Pselect){Dataservice.selectNannys().then(function(response){if($scope.result=response.data.result.Database[0].Table.Row[0].length,$scope.resultNannypagination=response.data.result.Database[0].Table.Row[0],$scope.resultNanny=$scope.resultNannypagination,0!=response.data.result.Database[0].Table.Row[0].length){$scope.resultNanny[0].certificacion,$scope.certifify=!0,$scope.objVerify=$scope.resultNanny[0].verificacion.split(",",9),$scope.very=$scope.objVerify;for(const key in $scope.very)"Residencia"==$scope.very[key]&&($scope.verify=!1)}else console.log("empty");""===op&&(op=10),pagination(op,Pselect)})},setTimeout(()=>{""!=cookie_experience&&setPersistenceExp(),""!=cookie_groupYears&&(listTempGroupYears.push(cookie_groupYears),persistenceGroupOfYearsNannys()),""!=cookie_serviceEsp&&(listTemServicesEsp.push(cookie_serviceEsp),persistenceServicesEspe()),""!=cookie_zone&&(listTemZone.push(cookie_zone),persistenceZone())},200),$scope.deletecookie=function(){cookie.delete("experience-persistence"),cookie.delete("groupYearsOldNannys-persistence"),cookie.delete("servicesEspe-persistence"),cookie.delete("zone-persistence"),cookie.delete("rangeYearsOld-persistence"),cookie.delete("rangePrice-persistence"),cookie.delete("PagesSelected-persistence"),location.href="/busqueda-de-nanny"},""!=cookie_rangeYearsOld&&"18,80"!=cookie_rangeYearsOld?persistenceRangeYearsOld():filterYearsOld(setRangeYearsOldMin,setRangeYearsOldMax,exp),""!=cookie_rangePrice&&"5,100"!=cookie_rangePrice?persistenceRangePrice():filterPrice(setRangePricedMin,setRangePricedMax,exp),""!=cookie_pagesSelected?(Pselect=cookie_pagesSelected,$scope.loadPages(10,Pselect)):""===cookie_experience&&""===cookie_groupYears&&""===cookie_serviceEsp&&""===cookie_zone&&$scope.loadPages(10,Pselect)}]);