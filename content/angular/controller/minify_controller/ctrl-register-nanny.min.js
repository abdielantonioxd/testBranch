app.controller("ctrl-register-nanny",["$scope","Dataservice","$http",function($scope,Dataservice,$http){function pushData(op){if("Nanny"!=op){form=$("#InicioSession").serializeArray(),form.push({name:"Option",value:"Create",name:"telefono",value:""});var hoy,dd,mm,yyyy,miembro=(dd=(hoy=new Date).getDate())+"/"+(mm=hoy.getMonth()+1)+"/"+(yyyy=hoy.getFullYear());form.push({name:"miembro",value:miembro}),forIn(form)}else{form=$("#formRegister").serializeArray();var hoy,dd,mm,yyyy,miembro=(dd=(hoy=new Date).getDate())+"/"+(mm=hoy.getMonth()+1)+"/"+(yyyy=hoy.getFullYear());form.push({name:"Option",value:"Create"}),form.push({name:"hashRpasword",value:""}),form.push({name:"miembro",value:miembro}),forIn(form)}}function forIn(form){obj=new Object;for(const i in form)obj[form[i].name]=form[i].value;validateInputForm(obj)}function validateInputForm(obj){obj.email&&""!=obj.password&&"on"==obj.terminos?($scope.emailCreateAccount=obj.email,"Nanny"!=obj.MethodRegister?sendDataOfFathers(obj):sendDataOfUsers(obj)):(alertify.set("notifier","position","top-right"),alertify.error("ocurrio un error,Todos los campos son obligatorios  !"))}function sendDataOfUsers(obj){$.ajax({type:"POST",url:UrlSendDatosUsers,timeout:2e3,data:obj,success:function(data){$scope.datosUser=data.result.Database[0].Table.Row[0],0==$scope.datosUser.length&&(alertify.set("notifier","position","top-right"),alertify.error("Ocurri√≥ un error,el correo ya esta en uso. "));var objId={id:$scope.datosUser[0].id};userActiveNanny.push({id:$scope.datosUser[0].id,email:$scope.datosUser[0].email}),0===opInit.length&&(opInit.push({id:$scope.datosUser[0].id,email:$scope.datosUser[0].email}),localStorage.setItem("datos",JSON.stringify(opInit)),$scope.linkCreateProfile=opInit[0].id),reserveSpaceIndDB(objId)},error:function(textStatus,err){console.log(textStatus+""+err)}})}function reserveSpaceIndDB(objId){$.ajax({type:"POST",url:UrlSendReservation,timeout:2e3,data:objId,success:function(data){var email;$scope.datosUser=data.result.Database[0].Table.Row[0],localStorage.setItem("sessionNanny",JSON.stringify(userActiveNanny)),alertify.set("notifier","position","top-right"),alertify.success("Bienvenido a nanny 365   <b>correo : </b>"+`<b>${$scope.emailCreateAccount}</b> `),sendEmailMessage($scope.emailCreateAccount),setTimeout(()=>{location.href=`/crear-perfil-nanny?nanny=${$scope.datosUser[0].nannyID}`},1e3),$("#formRegister")[0].reset()},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendDataOfFathers(obj){$.ajax({type:"POST",url:UrlSendDatosFathers,timeout:2e3,data:obj,success:function(data){$scope.datosUser=data.result.Database[0].Table.Row[0],userActiveFather.push({id:$scope.datosUser[0].id,email:$scope.datosUser[0].email}),localStorage.setItem("sessionFather",JSON.stringify(userActiveFather)),alertify.set("notifier","position","top-right"),alertify.success("Se  ha registrado con exito   <b>correo : </b>"+`<b>${$scope.emailCreateAccount}</b> `),setTimeout(()=>{$("#InicioSesion").modal("show")},2e3),$("#InicioSession")[0].reset()},error:function(textStatus,err){console.log(textStatus+""+err)}})}function sendEmailMessage(email){var data={email:email};$http.post("/send-confirmation",data).then(function(response){console.log(response),alertify.set("notifier","position","top-right"),alertify.success("se le ha enviado un mensage al correo!")})}$scope.validatePassword=function(){},$scope.validateDataForm=function(op){var response;0==grecaptcha.getResponse().length?(alertify.set("notifier","position","top-right"),alertify.error("Ocurrio un error,comprueba que no eres un robot!")):pushData(op)}}]);